---
- name: Test 'manage_transit_gateway' role
  block:
    # Creation
    - name: Create Transit Gateway with VPC attachemnt
      ansible.builtin.include_role:
        name: cloud.aws_ops.manage_transit_gateway
      vars:
        action: "create"
        transit_gateway:
          asn: 5200000000
          description: "TGW for Cloud team"
          tags:
            "Name": "{{ manage_transit_gateway_tgw_name }}"
        vpn_attachment:
          - customer_gateway_id: "{{ customer_gw_id }}"

    - name: test success with no parameters
      community.aws.ec2_vpc_vpn_info:
        register: manage_transit_gateway_result

    - name: assert that vpn connections are created
      assert:
        that:
          - 'manage_transit_gateway_result.vpn_connections != []'
